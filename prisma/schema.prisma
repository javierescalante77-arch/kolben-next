generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Clientes que verán /cliente y tendrán usuario/clave
model Cliente {
  id        Int     @id @default(autoincrement())
  nombre    String
  codigo    String  @unique
  activo    Boolean @default(true)
  claveHash String

  sucursales Int @default(1)

  createdAt DateTime @default(now())
  email     String?  @unique
  sucursalA Boolean  @default(true)
  sucursalB Boolean  @default(false)
  sucursalC Boolean  @default(false)
  updatedAt DateTime @default(now()) @updatedAt

  pedidos Pedido[]
}

/// Productos Kolben
model Producto {
  id          Int            @id @default(autoincrement())
  sku         String         @unique
  marca       String
  descripcion String
  tipo        TipoProducto
  estado      EstadoProducto @default(DISPONIBLE)

  /// ETA texto para "Reservar (en camino)", ej. "15/12/2025"
  eta String?

  /// Precio de referencia (puede ser null si no queremos guardarlo aquí)
  precio Float?

  /// URLs de imágenes almacenadas como JSON (array de strings)
  imagenes Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  items PedidoItem[]
}

/// Pedido de un cliente (carrito enviado)
model Pedido {
  id         Int          @id @default(autoincrement())
  clienteId  Int
  comentario String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now()) @updatedAt
  estado     EstadoPedido @default(PENDIENTE)

  /// Tipo de dispositivo desde el que se hizo el pedido (PC / Tablet / Celular)
  dispositivo String?

  cliente Cliente      @relation(fields: [clienteId], references: [id])
  items   PedidoItem[]
}

/// Línea individual de un pedido
model PedidoItem {
  id          Int       @id @default(autoincrement())
  pedidoId    Int
  cantidadA   Int       @default(0)
  cantidadB   Int       @default(0)
  cantidadC   Int       @default(0)
  createdAt   DateTime  @default(now())
  estadoTexto String?
  etaTexto    String?
  productoId  Int
  tipo        TipoLinea @default(NORMAL)

  pedido   Pedido   @relation(fields: [pedidoId], references: [id])
  producto Producto @relation(fields: [productoId], references: [id])
}

/// Estado de disponibilidad del producto en catálogo
enum EstadoProducto {
  DISPONIBLE
  BAJO_STOCK
  AGOTADO
  RESERVA
}

/// Tipo de producto (para las chips: maestro, auxiliar, pastillas, etc.)
enum TipoProducto {
  MAESTRO_FRENOS
  MAESTRO_CLUTCH
  AUXILIAR_FRENOS
  AUXILIAR_CLUTCH
  PASTILLAS_FRENO
}

/// Estado del pedido en el flujo Kolben
enum EstadoPedido {
  PENDIENTE
  PREPARANDO
  ENVIADO
}

/// Tipo de línea de pedido (normal o reserva/en camino)
enum TipoLinea {
  NORMAL
  RESERVA
}
